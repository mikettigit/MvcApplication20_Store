@using MvcApplication20.Models;
@functions{
    Category category;
    List<Category> Parents;
    Category Root;
}
@{
    category = Model as MvcApplication20.Models.Category;
    Parents = category.Parents;
    Root = (Parents.Count > 0) ? Parents.Last() : category;
}

<h3 class="subtitle">Каталог</h3>
<div class="box-category">
    @LineOut(Root)
</div>

@helper LineOut(Category CurrentCategory){
    <ul @((CurrentCategory == Root) ? "id=cat_accordion" : "") style="display:block;">
        @foreach (var Child in CurrentCategory.Children)
        {
            <li>
                <a href="@Child.RelativeUrl" @((Child.RelativeUrl == category.RelativeUrl) ? "class=active" : "")>@Child.Name</a>
                @if (Child.HasChildren)
                {
                    <span class="down"></span>
                }
                @LineOut(Child)
            </li>
        }
    </ul>
}